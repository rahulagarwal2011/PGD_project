<!DOCTYPE html>
<html>
<head>
  <title>PQC Transaction Platform</title>
  <link rel="stylesheet" href="/static/css/styles.css" />  
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .tab { display: none; }
    .tab-active { display: block; }
    button { margin-right: 10px; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
  </style>
</head>
<body>

  <h2>PQC Transaction Platform</h2>

  <button onclick="showTab('load')">Load Transactions</button>
  <button onclick="showTab('benchmark')">Benchmark Results</button>

  <!-- Tab 1: Single or Bulk load -->
  <div id="load" class="tab tab-active">
    <h3>Single Transaction</h3>
    <input type="text" id="singleData" placeholder="Enter dummy data as JSON string" />
    <button onclick="pushSingle()">Push Single Transaction</button>

    <h3>Bulk Transaction</h3>
    <input type="file" id="bulkFile" accept=".csv" />
    <button onclick="pushBulk()">Push Bulk Transactions</button>
  </div>

  <!-- Tab 2: Benchmark results -->
  <div id="benchmark" class="tab">
    <h3>Benchmark Results</h3>
    <button onclick="fetchBenchmarks()">Show Results</button>
    <table id="benchmarkTable">
      <tr><th>ID</th><th>Type</th><th>Latency (ms)</th></tr>
    </table>
  </div>

  <script>
    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('tab-active'));
      document.getElementById(tabId).classList.add('tab-active');
    }

    async function pushSingle() {
      const dataInput = document.getElementById("singleData").value;
      let data;
      try {
        data = JSON.parse(dataInput);
      } catch (e) {
        alert("Invalid JSON");
        return;
      }

      const res = await fetch("/encrypt-transaction/", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });
      const result = await res.json();
      alert(JSON.stringify(result));
    }

    async function pushBulk() {
      const file = document.getElementById("bulkFile").files[0];
      if (!file) { alert("Select a CSV file"); return; }

      const text = await file.text();
      const rows = text.split("\n").slice(1); // skip header

      let success = 0, fail = 0;
      for (const row of rows) {
        if (!row.trim()) continue;
        const cols = row.split(",");
        const data = {
          trans_date_trans_time: cols[0],
          cc_num: cols[1],
          merchant: cols[2],
          category: cols[3],
          amt: parseFloat(cols[4]),
          first: cols[5],
          last: cols[6],
          gender: cols[7],
          street: cols[8],
          city: cols[9],
          state: cols[10],
          zip: parseInt(cols[11]),
          lat: parseFloat(cols[12]),
          long: parseFloat(cols[13]),
          city_pop: parseInt(cols[14]),
          job: cols[15],
          dob: cols[16],
          trans_num: cols[17],
          unix_time: parseInt(cols[18]),
          merch_lat: parseFloat(cols[19]),
          merch_long: parseFloat(cols[20]),
          is_fraud: parseInt(cols[21])
        };

        const res = await fetch("/encrypt-transaction/", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });
        if (res.ok) success++; else fail++;
      }

      alert(`Bulk load complete. Success: ${success}, Fail: ${fail}`);
    }

    async function fetchBenchmarks() {
      const res = await fetch("/benchmarks");
      const data = await res.json();

      const table = document.getElementById("benchmarkTable");
      table.innerHTML = "<tr><th>ID</th><th>Type</th><th>Latency (ms)</th></tr>";
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.id}</td><td>${row.type}</td><td>${row.latency}</td>`;
        table.appendChild(tr);
      });
    }
  </script>
</body>
</html>
